{"version":3,"file":"src_sandboxers_HTML_adaptors_useCustomElements_ts.js","sources":["webpack://aero-sandbox/./src/sandboxers/HTML/adaptors/useCustomElements.ts","webpack://aero-sandbox/./src/sandboxers/HTML/shared/proxifyCustomElementName.ts"],"sourcesContent":["import rewriteSrc from \"$aero/src/shared/src\";\nimport type { onAttrHandler } from \"$aero/types/htmlRules\";\n// TODO: Use $shared\nimport htmlSrc from \"../shared/htmlSrc\";\n\nimport proxifyCustomElementName from \"../shared/proxifyCustomElementName\";\n\nimport htmlRules from \"../shared/htmlRules\";\n\n{\n\tfor (const [OriginalHTMLElement, htmlRule] of htmlRules.entries()) {\n\t\tlet observeAttributesArray: string[] = [];\n\t\tcustomElements.define(\n\t\t\tproxifyCustomElementName(htmlRule.tagName),\n\t\t\t// @ts-ignore\n\t\t\tclass ProxifiedElement extends OriginalHTMLElement {\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper();\n\t\t\t\t\tobserveAttributesArray = Object.keys(\n\t\t\t\t\t\thtmlRule.onAttrHandlers\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tattributeChangedCallback(attrName, _oldVal, newVal) {\n\t\t\t\t\tconst handler = htmlRule.onAttrHandlers[attrName];\n\t\t\t\t\tif (handler) {\n\t\t\t\t\t\tconst rewriteHandler =\n\t\t\t\t\t\t\thtmlRule.onAttrHandlers[attrName];\n\t\t\t\t\t\tlet actualRewriteHandler: onAttrHandler;\n\t\t\t\t\t\tif (rewriteHandler === \"rewrite-src\")\n\t\t\t\t\t\t\tactualRewriteHandler = (newVal: string) => {\n\t\t\t\t\t\t\t\treturn rewriteSrc(newVal);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\telse if (rewriteHandler === \"rewrite-html-src\")\n\t\t\t\t\t\t\tactualRewriteHandler = (newVal: string) => {\n\t\t\t\t\t\t\t\treturn htmlSrc(newVal);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\telse actualRewriteHandler = rewriteHandler[attrName];\n\t\t\t\t\t\tsuper.setAttribute(\n\t\t\t\t\t\t\tattrName,\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\tactualRewriteHandler(newVal)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tstatic get observeAttributes() {\n\t\t\t\t\treturn observeAttributesArray;\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\textends: htmlRule.tagName\n\t\t\t}\n\t\t);\n\t}\n}\n\n// \"is\" appending with Custom Elements\n// You can also use a Mutation Observer. TODO: I will make a flag so that you can choose which method you prefer.\n// TODO: On the SW wrap the site content with `$aero.config.htmlSandboxElementName`\n{\n\tconst alreadyRewrittenChildren = new WeakSet<Element>();\n\tclass HTMLSandbox extends HTMLDivElement {\n\t\tconnectedCallback() {\n\t\t\tfor (const child of super.children) {\n\t\t\t\tif (!alreadyRewrittenChildren.has(child)) {\n\t\t\t\t\tfor (const [\n\t\t\t\t\t\tOriginalHTMLElement,\n\t\t\t\t\t\thtmlRule\n\t\t\t\t\t] of htmlRules.entries()) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t// @ts-ignore\n\t\t\t\t\t\t\tchild instanceof OriginalHTMLElement &&\n\t\t\t\t\t\t\t// Parity check\n\t\t\t\t\t\t\thtmlRule.tagName === child.tagName\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\tchild.setAttribute(\n\t\t\t\t\t\t\t\t\"is\",\n\t\t\t\t\t\t\t\tproxifyCustomElementName(child.tagName)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\talreadyRewrittenChildren.add(child);\n\t\t\t\t} else {\n\t\t\t\t\t// Toggle\n\t\t\t\t\talreadyRewrittenChildren.delete(child);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tcustomElements.define($aero.config.htmlSandboxElementName, HTMLSandbox);\n}\n","const key = \"proxified_\";\nexport { key };\n\nexport default (name: string) => `${key}_${name}`;\n"],"names":["rewriteSrc","htmlSrc","proxifyCustomElementName","htmlRules","_iteratorError","OriginalHTMLElement","htmlRule","observeAttributesArray","customElements","define","tagName","ProxifiedElement","Object","keys","onAttrHandlers","attributeChangedCallback","attrName","_oldVal","newVal","handler","rewriteHandler","actualRewriteHandler","key","extends","entries","alreadyRewrittenChildren","WeakSet","HTMLSandbox","connectedCallback","child","has","_iteratorError1","_instanceof","setAttribute","add","delete","HTMLDivElement","$aero","config","htmlSandboxElementName","name","concat"],"mappings":"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"}