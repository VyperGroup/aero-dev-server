{"version":3,"file":"src_sandboxers_HTML_shared_htmlRules_ts-src_sandboxers_HTML_shared_htmlSrc_ts.js","sources":["webpack://aero-sandbox/./src/cors/policy.ts","webpack://aero-sandbox/./src/sandboxers/HTML/shared/Cloner.ts","webpack://aero-sandbox/./src/sandboxers/HTML/shared/csp.ts","webpack://aero-sandbox/./src/sandboxers/HTML/shared/htmlRules.ts","webpack://aero-sandbox/./src/sandboxers/HTML/shared/htmlSrc.ts","webpack://aero-sandbox/./src/sandboxers/HTML/shared/tt.ts","webpack://aero-sandbox/./src/shared/appendSearchParam.ts"],"sourcesContent":["// TODO: Check the policy of the parent's too in case this is an iframe\nexport default list => {\n\tif (list) {\n\t}\n\n\treturn false;\n};\n","import { safeText } from \"./tt\";\n\nimport Cloner from \"./Cloner\";\n\n// In the case of CORS attributes present the original is deleted and a new clone is made because it isn't possible to modify the CORS properties internally\nexport default class {\n\tel: HTMLElement;\n\tcopy: HTMLElement;\n\n\t/**\n\t * Clones an element without their read-only integrity attribute\n\t * @constructor\n\t * @param - The element to be cloned\n\t */\n\tconstructor(el: HTMLElement) {\n\t\tconst copy = document.createElement(el.tagName);\n\n\t\tthis.el = el;\n\t\tthis.copy = copy;\n\n\t\tcopy[\"observed\"] = true;\n\n\t\tfor (const name of el.getAttributeNames())\n\t\t\tif (name !== \"integrity\") copy[name] = el[name];\n\n\t\tif (\"innerHTML\" in el && el.innerHTML !== \"\")\n\t\t\tsafeText(copy, el.innerHTML);\n\t}\n\tclone() {\n\t\t// Insert\n\t\tthis.el.after(this.copy);\n\t}\n\tstatic deleteScript(script: HTMLElement) {\n\t\tif (script instanceof HTMLScriptElement) {\n\t\t\t// Disable old script by breaking the type so it doesn't run\n\t\t\tscript.type = \"_\";\n\n\t\t\tsafeText(script, \"\");\n\t\t}\n\n\t\tscript.remove();\n\t}\n\tcleanup() {\n\t\tCloner.deleteScript(this.el);\n\t}\n}\n","import { proxyLocation } from \"$shared/proxyLocation\";\n\n// TODO: Use policy.ts\n\n// Gets the sources in the CSP with directive\nfunction cspSrc(dir: string): string[] {\n\tconst [sources] = $aero.sec.csp.match(new RegExp(`${dir} ([^;]*)`), \"g\");\n\n\tif (typeof sources === \"undefined\") return;\n\n\treturn sources.split(\" \");\n}\n\n// If CSP blocked\nexport default (dir: string): boolean => {\n\tconst sources = cspSrc(dir);\n\n\tlet blocked = false;\n\n\tif (sources) {\n\t\tlet allowed = false;\n\n\t\tif (!sources.includes(\"'none'\"))\n\t\t\tfor (const source of sources) {\n\t\t\t\tif (proxyLocation().href.startsWith(source)) {\n\t\t\t\t\tallowed = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// TODO: Instead use matchWildcard for full accuracy\n\t\t\t\tconst wc = source.split(\"*\");\n\n\t\t\t\tif (\n\t\t\t\t\t// Wildcard found\n\t\t\t\t\twc.length > 1 &&\n\t\t\t\t\tproxyLocation().href.startsWith(wc[0])\n\t\t\t\t) {\n\t\t\t\t\tallowed = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\tif (!allowed) blocked = true;\n\t}\n\n\treturn blocked;\n};\n","import type { htmlRule } from \"$aero/types/htmlRules\";\n\nimport allow from \"./csp\";\nimport Cloner from \"./Cloner\";\n\nimport appendSearchParam from \"$shared/appendSearchParam\";\nimport block from \"$cors/policy\";\n\nimport rewriteSrc from \"$shared/src\";\n\nimport { proxyLocation } from \"$shared/proxyLocation\";\n\n// biome-ignore lint/suspicious/noExplicitAny: TODO: Make any Element\nconst htmlRules = new Map<any, htmlRule>();\n\nconst blockHandler =\n\t(allowDir: string) =>\n\t(_el: HTMLElement, newVal: string): string => {\n\t\tif (block(\"allowDir\")) return \"\";\n\t};\n\n// @ts-ignore\nhtmlRules.set(HTMLScriptElement, {\n\tmustBeNew: true,\n\tonAttrHandlers: {\n\t\tsrc: (el: HTMLScriptElement, newVal: string) => {\n\t\t\tif (allow(\"script-src\")) {\n\t\t\t\tconst url = new URL(newVal);\n\n\t\t\t\tconst isMod = el.type === \"module\";\n\n\t\t\t\tconst params = url.searchParams;\n\n\t\t\t\tappendSearchParam(\n\t\t\t\t\tparams,\n\t\t\t\t\t$aero.searchParamOptions.isModule,\n\t\t\t\t\tisMod.toString()\n\t\t\t\t);\n\n\t\t\t\tif (isMod && el.integrity) {\n\t\t\t\t\tappendSearchParam(\n\t\t\t\t\t\tparams,\n\t\t\t\t\t\t$aero.searchParamOptions.integrity,\n\t\t\t\t\t\tel.integrity\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn url.href;\n\t\t\t}\n\t\t},\n\t\t// @ts-ignore\n\t\tonCreateHandler: (el: HTMLScriptElement) => {\n\t\t\tif (\n\t\t\t\t!el.src &&\n\t\t\t\ttypeof el.innerHTML === \"string\" &&\n\t\t\t\tel.innerHTML !== \"\" &&\n\t\t\t\t// Ensure the script has a JS type\n\t\t\t\t(el.type === \"\" ||\n\t\t\t\t\tel.type === \"module\" ||\n\t\t\t\t\tel.type === \"text/javascript\" ||\n\t\t\t\t\tel.type === \"application/javascript\")\n\t\t\t) {\n\t\t\t\t// FIXME: Fix safeText so that it could be used here\n\t\t\t\tel.innerHTML = $aero.js.wrapScript(el.innerText, {\n\t\t\t\t\tisModule: el.type === \"module\"\n\t\t\t\t});\n\n\t\t\t\t// The inline code is read-only, so the element must be cloned\n\t\t\t\tconst cloner = new Cloner(el);\n\n\t\t\t\tcloner.clone();\n\t\t\t\tcloner.cleanup();\n\t\t\t}\n\t\t}\n\t}\n});\n\nconst linkElements = [HTMLAnchorElement, HTMLAreaElement, HTMLBaseElement];\nfor (const linkElement of linkElements)\n\thtmlRules.set(linkElement, {\n\t\tonAttrHandlers: {\n\t\t\thref: \"rewrite-html-src\"\n\t\t}\n\t});\nhtmlRules.set(SVGAElement, {\n\tonAttrHandlers: {\n\t\thref: \"rewrite-html-src\",\n\t\t\"xlink:href\": \"rewrite-html-src\"\n\t}\n});\nhtmlRules.set(HTMLFormElement, {\n\tonAttrHandlers: {\n\t\taction: \"rewrite-html-src\"\n\t}\n});\n\n// @ts-ignore\nhtmlRules.set(HTMLPortalElement, {\n\tonAttrHandlers: {\n\t\tsrc: \"rewrite-html-src\"\n\t}\n});\n\n// Permissions Policy emulation\nhtmlRules.set(HTMLImageElement, {\n\tonAttrHandlers: {\n\t\tsrc: blockHandler(\"img-src\")\n\t}\n});\nconst autoplayElements = [HTMLAnchorElement, HTMLAreaElement, HTMLBaseElement];\nfor (const autoplayElement of autoplayElements)\n\thtmlRules.set(autoplayElement, {\n\t\tonAttrHandlers: {\n\t\t\tautoplay: blockHandler(\"autoplay\")\n\t\t}\n\t});\n\n{\n\tconst sec: {\n\t\tcsp?: string;\n\t\tperms?: string;\n\t\tpr?: string;\n\t} = {};\n\n\thtmlRules.set(HTMLIFrameElement, {\n\t\tonAttrHandlers: {\n\t\t\tsrc: (el: HTMLIFrameElement, newVal: string) => {\n\t\t\t\tif (!block(\"frame-src\")) return \"\";\n\t\t\t\t// Embed the origin as an attribute, so that the frame can reference it to do its checks\n\t\t\t\t// @ts-ignore\n\t\t\t\tel.contentWindow.$aero.frame.parentProxyOrigin =\n\t\t\t\t\tproxyLocation().origin;\n\t\t\t\treturn newVal;\n\t\t\t\t// TODO: Bring back\n\t\t\t},\n\t\t\t// Inject aero imports\n\t\t\tsrcdoc: (_el: HTMLIFrameElement, newVal: string) =>\n\t\t\t\t$aero.init + newVal,\n\t\t\t// Emulate CSP later\n\t\t\tcsp: (_el: HTMLIFrameElement, newVal: string, oldVal: string) => {\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\tallow: (_el: HTMLIFrameElement, newVal: string, oldVal: string) => {\n\t\t\t\tsec.perms = oldVal;\n\t\t\t\treturn \"\";\n\t\t\t},\n\t\t\tallowPaymentRequest: (\n\t\t\t\t_el: HTMLIFrameElement,\n\t\t\t\t_newVal: string,\n\t\t\t\toldVal: string\n\t\t\t) => {\n\t\t\t\tsec.pr = oldVal;\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t},\n\t\tonCreateHandler: (el: HTMLIFrameElement) => {\n\t\t\t// @ts-ignore\n\t\t\tel.contentWindow.$aero.frame.sec = JSON.stringify(sec);\n\t\t}\n\t});\n}\n\nhtmlRules.set(HTMLMetaElement, {\n\tonAttrHandlers: {\n\t\thttpEquiv: (el: HTMLMetaElement, newVal: string) => {\n\t\t\tswitch (newVal) {\n\t\t\t\tcase \"content-security-policy\":\n\t\t\t\t\treturn el.content;\n\t\t\t\tcase \"refresh\":\n\t\t\t\t\treturn el.content.replace(\n\t\t\t\t\t\t/^([0-9]+)(;)(\\s+)?(url=)(.*)/g,\n\t\t\t\t\t\t(_match, g1, g2, g3, g4, g5) =>\n\t\t\t\t\t\t\tg1 +\n\t\t\t\t\t\t\tg2 +\n\t\t\t\t\t\t\tg3 +\n\t\t\t\t\t\t\tg4 +\n\t\t\t\t\t\t\trewriteSrc(g5, proxyLocation().href)\n\t\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n\nexport default htmlRules;\n","import sharedConfig from \"$shared/sharedConfig\";\n\nimport rewriteSrc from \"$src/shared/src\";\n\nimport { proxyLocation } from \"$shared/proxyLocation\";\n\n/**\n * Extends src rewriting for processed html urls\n * @param - The url to rewrite\n * @param - If its to rewrite an iFrame src\n */\nexport default (src: string, isIFrame?: boolean): string => {\n\t// TODO: rewrite\n\tif (src instanceof Blob) return src;\n\n\tconst url = $aero.proto.get(\n\t\tsrc.replace(new RegExp(`^(${location.origin})`, \"g\"), \"\")\n\t);\n\n\tif (/^javascript:/g.test(url))\n\t\treturn sharedConfig(\"rewriters\").js.wrapScript(url);\n\tif (/^data:/g.test(url)) {\n\t\tif (isIFrame) {\n\t\t\tconst exp = /^data:text\\/html(;base64)?,/g;\n\n\t\t\tconst matches = [...url.matchAll(exp)];\n\n\t\t\tif (matches.length === 2)\n\t\t\t\treturn matches[0].replace(\n\t\t\t\t\texp,\n\t\t\t\t\t`$&${encodeURIComponent(\n\t\t\t\t\t\t$aero.init + decodeURIComponent(url)\n\t\t\t\t\t)}`\n\t\t\t\t);\n\t\t\tif (matches.length === 1)\n\t\t\t\treturn `$&${btoa($aero.init + atob(url))}`;\n\t\t}\n\t\treturn url;\n\t}\n\tif (\n\t\t// Ignore about:blank\n\t\t/^about:/g.test(url) ||\n\t\t// Don't rewrite again\n\t\tnew RegExp(`^(${sharedConfig(\"prefix\")})`).test(url)\n\t)\n\t\treturn url;\n\n\treturn rewriteSrc(url, proxyLocation().href);\n};\n","import {\n\tTrustedHTML,\n\tTrustedTypePolicy,\n\tTrustedTypesWindow\n} from \"trusted-types/lib\";\n\nimport config from \"$aero/examples/config\";\n\nconst { flags } = config;\n\n// @ts-ignore\n// biome-ignore lint/suspicious/noImplicitAnyLet: <explanation>\ndeclare let trustedTypes;\n\n// For Cors Emulation\nconst tt = trustedTypes.createPolicy(\"$aero\", {\n\tcreateHTML: str => str,\n\tcreateScript: str => str\n});\n\n// A safe wrapper for text to comply with trusted types\nconst safeText = (el: HTMLElement, str: string) => {\n\tconst isScript = el instanceof HTMLScriptElement;\n\n\tel.innerHTML = flags.corsEmulation\n\t\t? tt[isScript ? \"createHTML\" : \"createScript\"](str)\n\t\t: str;\n};\n\nexport { tt, safeText };\n","import type { SearchParamOptions } from \"../../../../types/catch-all\";\n\n// appendSearchParam.ts\nexport default (\n\tsearchParams: URLSearchParams,\n\tsearchParamOptions: SearchParamOptions,\n\tstr: string\n) => {\n\t// Until a compatible search param is found\n\tconst escapingCharCount = 0;\n\twhile (true) {\n\t\tlet escapesStr = \"\";\n\t\tfor (let i = 0; i < escapingCharCount; i++)\n\t\t\tescapesStr += searchParamOptions.escapeKeyword;\n\n\t\t// Try the search param with yet another escapeChar\n\t\tconst paramToTry = escapesStr + searchParamOptions.searchParam;\n\t\tif (!searchParams.has(paramToTry))\n\t\t\treturn searchParams.set(paramToTry, str);\n\t}\n};\n"],"names":["list","safeText","Cloner","el","copy","document","createElement","tagName","_iteratorError","getAttributeNames","name","innerHTML","clone","after","cleanup","deleteScript","script","_instanceof","HTMLScriptElement","type","remove","proxyLocation","cspSrc","dir","_$aero_sec_csp_match","sec","csp","match","RegExp","concat","sources","split","blocked","allowed","includes","source","href","startsWith","wc","length","allow","appendSearchParam","block","rewriteSrc","htmlRules","Map","blockHandler","allowDir","_el","newVal","set","mustBeNew","onAttrHandlers","src","url","URL","isMod","params","searchParams","$aero","searchParamOptions","isModule","toString","integrity","onCreateHandler","js","wrapScript","innerText","cloner","linkElements","HTMLAnchorElement","HTMLAreaElement","HTMLBaseElement","linkElement","SVGAElement","HTMLFormElement","action","HTMLPortalElement","HTMLImageElement","autoplayElements","_iteratorError1","autoplayElement","autoplay","HTMLIFrameElement","contentWindow","frame","parentProxyOrigin","origin","srcdoc","init","oldVal","perms","allowPaymentRequest","_newVal","pr","JSON","stringify","HTMLMetaElement","httpEquiv","content","replace","_match","g1","g2","g3","g4","g5","sharedConfig","isIFrame","Blob","proto","get","location","test","exp","matches","matchAll","encodeURIComponent","decodeURIComponent","btoa","atob","config","flags","tt","trustedTypes","createPolicy","createHTML","str","createScript","isScript","corsEmulation","escapingCharCount","escapesStr","i","escapeKeyword","paramToTry","searchParam","has"],"mappings":"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"}